# BlogSpider

## 소개

AUSG 멤버들의 블로그에서 가장 최신 포스트를 파싱해, json 형태로 저장합니다. 이 파일은 같은 레포에서 개발/배포하는 [https://ausg.me]의 블로그 페이지에서 사용됩니다.

각 블로그에 맞는 css selector는 모두 직접 만들었습니다.

그리고 정확히는 '파서'가 맞는데, 입에 붙어서 그런지 자꾸 '크롤러'라는 표현을 쓰게 되네요. 본 서비스에선 두 단어를 같은 의미로 사용합니다.

## 작동 방식

`/.github/workflows/updateBlogPostList.yml` 워크플로우는 하루에 한 번 실행되게 세팅되어 있습니다 (cron). 한국 시간 오전 9시 정각인데 이게 딜레이가 심각해서 대략 10~12시 사이에 실행되고 있습니다.

자세한 건 저 파일을 보시면 알 수 있습니다.


## 자신의 블로그 추가 방법

tl;dr: blogList.csv 파일에 정보 추가 & `PARSER` 상수에 셀렉터 추가

> 테스트 환경 : macOS 10.15, python3.9

1. 가상환경 구축 (not mandatory)

```sh
cd lib/blogSpider &&\
python3 -m venv .venv &&\
. .venv/bin/activate
```

2. 패키지 설치

```sh
pip3 install -r requirements.txt
# 만약 추가로 패키지를 설치했다면 전체 개발이 끝난 후 꼭 아래 명령어를 적용해야 레포에 반영됨
pip3 freeze > requirements.txt
```

3. blogList.csv에 자신의 블로그 추가.

포맷 : `파싱할URL,이름,블로그타입,홈페이지URL`

> `파싱할URL`은 데이터를 파싱할 때 사용합니다. 정확히는, '가장 최신글을 확인할 수 있는 페이지'의 URL이 필요합니다. 보통은 자신의 블로그 메인화면이 이러한 페이지에 해당하는데, 몇몇 특수한 경우도 있습니다. ([목록 페이지가 메인 페이지가 아닌 예시](https://choheeis.github.io/newblog/archive/))
>
> 만약 CSR이 적용된 블로그라면 파싱이 진행되는 시점에 데이터가 완전히 로딩되지 않아 새 글이 보이지 않는 경우도 있습니다. 이런 경우엔 보통 RSS 피드를 연동하는 쪽이 정신건강에 낫습니다. ([전체 글이 보이는 페이지가 없어서 RSS 피드를 만든 예시](https://umi0410.github.io/index.xml))

`홈페이지URL`은 링크를 만들 때 사용합니다. (홈페이지에서 링크를 만들 때 사용됨)

`파싱할URL`과 `홈페이지URL`가 같다면 홈페이지URL을 생략할 수 있습니다.

`블로그타입`은 아래에서 자세히 설명합니다.

4. 블로그타입 찾기 or 셀렉터 추가하기

각각의 블로그타입은 파서 하나에 해당합니다. `parsingService.py`의 상단 `PARSER`를 보시면, 블로그타입마다 두 개의 셀렉터가 지정된 것을 확인할 수 있습니다. (XML, 즉 RSS 피드는 좀 다르게 생겼음)

만약 본인의 블로그에서, 이 셀렉터들을 적용해 봤을 때 정확하게 **첫 번째 글의 제목과 본문**을 잡아낸다면 그냥 그걸 블로그타입에 넣으시면 됩니다.

중요한 점은, **셀렉터는 꼭 그 항목만 정확하게 뽑지 않아도 됩니다.** 여러 엘리먼트가 잡혀도, '첫번째 글의 제목과 본문'이 첫번째 엘리먼트로 포착되면 충분합니다. `parsingService.py`의 `crawlHtml` 메서드에서 `[0]` 부분을 보시면 이해하실 겁니다.

> 본문은 없다면 생략해도 됩니다.

그렇지 않다면, 직접 적절한 셀렉터를 찾아서 새로운 블로그타입을 지정하고, PARSER에 같은 이름으로 추가해서 셀렉터를 넣으면 됩니다.

5. 린팅

```sh
# cd lib/blogSpider
black -v .
```

6. 테스트 및 push

```sh
python3 main.py
```

테스트를 마치면 `newsetPosts.json` 파일이 갱신됩니다. 문제없이 추가되었는지 확인해보시고 push하면 됩니다.

(Github Action에 의해 깃헙 서버에서 하루에 한번씩 자동으로 코드가 실행되고 json 파일이 갱신됩니다)

## etc

하시다 어려운 건 문성혁 (roeniss) 를 찾아주세요.
